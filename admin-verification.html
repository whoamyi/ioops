<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOOPS Admin - Verification Management</title>
    <link rel="stylesheet" href="css/admin-verification.css">
    <link rel="stylesheet" href="css/shipment-agent.css">
</head>
<body>
    <div class="admin-portal">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="seal">âš–</div>
                    <div>
                        <h1>IOOPS Admin Portal</h1>
                        <p class="subtitle">Verification Management System</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat-box">
                        <span class="stat-label">Pending Review</span>
                        <span class="stat-value" id="pending-count">0</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Active Today</span>
                        <span class="stat-value" id="active-count">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Filters -->
        <div class="filters-bar">
            <div class="filter-group">
                <label>Status Filter:</label>
                <select id="status-filter">
                    <option value="all">All Verifications</option>
                    <option value="initiated">Initiated (Pending Step 1)</option>
                    <option value="documents_submitted">Documents Submitted (Pending Review)</option>
                    <option value="payment_submitted">Payment Submitted (Pending Approval)</option>
                    <option value="escrow_confirmed">Escrow Confirmed (Pending Code)</option>
                    <option value="code_generated">Code Generated</option>
                    <option value="completed">Completed</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Search:</label>
                <input type="text" id="search-input" placeholder="Tracking ID, email, or name...">
            </div>
            <button id="refresh-btn" class="btn-refresh">â†» Refresh</button>
        </div>

        <!-- Navigation Tabs -->
        <div class="admin-tabs">
            <button class="tab-btn active" data-tab="verifications">Verifications</button>
            <button class="tab-btn" data-tab="shipments">Shipments</button>
            <button class="tab-btn" onclick="openShipmentAgentModal()" style="margin-left: auto; background: #d4af37; color: #1a1a2e;">ðŸš€ Generate Shipment</button>
        </div>

        <!-- Main Content -->
        <main class="admin-content">
            <!-- Verifications List -->
            <div class="verifications-list tab-content" id="verifications-list">
                <div class="loading-spinner" id="loading">
                    <div class="spinner"></div>
                    <p>Loading verifications...</p>
                </div>
            </div>

            <!-- Detail Panel (shown when clicking a verification) -->
            <div class="detail-panel" id="detail-panel" style="display: none;">
                <div class="panel-header">
                    <h2>Verification Details</h2>
                    <button class="btn-close" id="close-panel">Ã—</button>
                </div>

                <div class="panel-content" id="panel-content">
                    <!-- Dynamic content loaded here -->
                </div>
            </div>

            <!-- Shipments Tab -->
            <div id="shipments-tab" class="tab-content" style="display: none;">
                <table class="shipments-table">
                    <thead>
                        <tr>
                            <th>Tracking ID</th>
                            <th>Status</th>
                            <th>Location</th>
                            <th>Recipient</th>
                            <th>Verification</th>
                            <th>Security Code</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="shipments-tbody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px;">
                                <div class="spinner"></div>
                                <p>Loading shipments...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Email Modal -->
    <div id="email-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Send Email to Recipient</h2>
                <button class="btn-close" id="close-email-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Template Category</label>
                    <select id="template-category">
                        <option value="">Select category...</option>
                        <option value="VERIFICATION">Verification</option>
                        <option value="COMPLIANCE">Compliance</option>
                        <option value="OVERSIGHT">Oversight</option>
                        <option value="CORRECTIONS">Corrections</option>
                        <option value="CLEARANCE">Clearance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Template</label>
                    <select id="template-name">
                        <option value="">Select template...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>From Address</label>
                    <select id="from-alias">
                        <option value="">Select email address...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Your Message *</label>
                    <textarea id="custom-message" rows="5" placeholder="Enter your message here..."></textarea>
                    <p class="field-hint">This will be inserted into the [CUSTOM_MESSAGE] placeholder in the template.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancel-email">Cancel</button>
                <button class="btn-primary" id="send-email">Send Email</button>
            </div>
        </div>
    </div>

    <!-- Security Code Edit Modal -->
        <!-- Rejection Modal with Preset Reasons -->
    <div id="rejection-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reject Document</h2>
                <button class="btn-close" id="close-rejection-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <p>Document: <strong id="rejection-document-name"></strong></p>

                <div class="form-group">
                    <label for="preset-rejection-reason">Select a Reason</label>
                    <select id="preset-rejection-reason" class="form-control">
                        <option value="">-- Select a reason --</option>
                        <option value="Image too dark or blurry">Image too dark or blurry</option>
                        <option value="Document details not visible">Document details not visible</option>
                        <option value="Expired document">Expired document</option>
                        <option value="Wrong document type submitted">Wrong document type submitted</option>
                        <option value="Face not clearly visible">Face not clearly visible (selfie)</option>
                        <option value="Document appears to be fake or tampered">Document appears to be fake or tampered</option>
                        <option value="Address on document doesn't match submitted address">Address doesn't match (proof of address)</option>
                        <option value="Document is older than 3 months">Document is older than 3 months (proof of address)</option>
                        <option value="custom">Other - I'll type my own reason</option>
                    </select>
                </div>

                <div class="form-group" id="custom-rejection-reason-group" style="display: none; margin-top: 16px;">
                    <label for="custom-rejection-reason">Custom Reason</label>
                    <textarea id="custom-rejection-reason" class="form-control" rows="3" placeholder="Please provide a clear reason for rejection..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancel-rejection">Cancel</button>
                <button class="btn-danger" id="confirm-rejection">Reject Document</button>
            </div>
        </div>
    </div>


    <!-- Payment Rejection Modal -->
    <div id="payment-rejection-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reject Payment Receipt</h2>
                <button class="btn-close" id="close-payment-rejection-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <p>You are about to reject the payment receipt for verification <strong id="payment-rejection-tracking-id"></strong></p>
                
                <div class="form-group">
                    <label for="preset-payment-rejection-reason">Select a Reason</label>
                    <select id="preset-payment-rejection-reason" class="form-control">
                        <option value="">-- Select a reason --</option>
                        <option value="Receipt image is too dark or blurry to verify">Receipt image is too dark or blurry</option>
                        <option value="Payment amount does not match required amount">Payment amount does not match</option>
                        <option value="Payment receipt appears to be edited or tampered">Receipt appears to be edited/tampered</option>
                        <option value="Payment date is incorrect or too old">Payment date is incorrect/too old</option>
                        <option value="Bank details or payment method not visible">Bank details not visible</option>
                        <option value="Receipt does not show transaction confirmation">No transaction confirmation shown</option>
                        <option value="Receipt is from wrong payment method">Wrong payment method used</option>
                        <option value="Recipient name on receipt doesn't match verification">Recipient name doesn't match</option>
                        <option value="custom">Other - I'll type my own reason</option>
                    </select>
                </div>
                
                <div class="form-group" id="custom-payment-rejection-reason-group" style="display: none; margin-top: 16px;">
                    <label for="custom-payment-rejection-reason">Custom Reason</label>
                    <textarea id="custom-payment-rejection-reason" class="form-control" rows="3" placeholder="Please provide a clear reason for payment rejection..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancel-payment-rejection">Cancel</button>
                <button class="btn-danger" id="confirm-payment-rejection">Reject Payment</button>
            </div>
        </div>
    </div>

    <div id="code-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Security Code</h2>
                <button class="btn-close" id="close-code-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <p>Tracking ID: <strong id="code-tracking-id"></strong></p>
                <div class="form-group">
                    <label>Security Code (10 characters)</label>
                    <input type="text" id="new-security-code" maxlength="10" pattern="[A-Z0-9]{10}" style="text-transform: uppercase;">
                    <p class="field-hint">Alphanumeric uppercase only (A-Z, 0-9)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancel-code">Cancel</button>
                <button class="btn-primary" id="save-code">Save Code</button>
            </div>
        </div>
    </div>

    <!-- Shipment Event Generator Agent Modal -->
    <div id="shipment-agent-modal" class="shipment-agent-modal">
        <div class="shipment-agent-modal-content">
            <div class="modal-header">
                <h2>ðŸš€ Shipment Event Generator Agent</h2>
                <button class="close-modal-btn close-shipment-agent-modal">&times;</button>
            </div>

            <div class="modal-body">
                <form id="shipment-agent-form">
                    <!-- Quick Templates -->
                    <div class="config-templates-section">
                        <h3>Quick Templates</h3>
                        <div id="config-templates" class="config-templates-grid">
                            <!-- Templates loaded dynamically -->
                        </div>
                    </div>

                    <!-- Route Configuration -->
                    <div class="form-section">
                        <h3>Route Configuration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="origin-airport-select">Origin Airport *</label>
                                <select id="origin-airport-select" required>
                                    <option value="">Select Origin</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="destination-airport-select">Destination Airport *</label>
                                <select id="destination-airport-select" required>
                                    <option value="">Select Destination</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Shipper Information -->
                    <div class="form-section">
                        <h3>Shipper Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="shipper-name-input">Shipper Name *</label>
                                <input type="text" id="shipper-name-input" placeholder="Company or Person Name" required>
                            </div>
                            <div class="form-group">
                                <label for="shipper-address-input">Shipper Address *</label>
                                <input type="text" id="shipper-address-input" placeholder="Full Address" required>
                            </div>
                        </div>
                    </div>

                    <!-- Recipient Information -->
                    <div class="form-section">
                        <h3>Recipient Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recipient-name-input">Recipient Name *</label>
                                <input type="text" id="recipient-name-input" placeholder="Full Name" required>
                            </div>
                            <div class="form-group">
                                <label for="recipient-email-input">Recipient Email</label>
                                <input type="email" id="recipient-email-input" placeholder="email@example.com">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recipient-address-input">Recipient Address *</label>
                                <input type="text" id="recipient-address-input" placeholder="Street Address" required>
                            </div>
                            <div class="form-group">
                                <label for="recipient-city-input">Recipient City *</label>
                                <input type="text" id="recipient-city-input" placeholder="City" required>
                            </div>
                        </div>
                    </div>

                    <!-- Package Information -->
                    <div class="form-section">
                        <h3>Package Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="declared-value-input">Declared Value *</label>
                                <input type="text" id="declared-value-input" placeholder="â‚¬2,500" required>
                            </div>
                            <div class="form-group">
                                <label for="weight-input">Weight *</label>
                                <input type="text" id="weight-input" placeholder="5kg" required>
                            </div>
                        </div>
                    </div>

                    <!-- Security Configuration -->
                    <div class="form-section">
                        <h3>Security Configuration (Optional)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="security-zone-select">Security Hold Zone</label>
                                <select id="security-zone-select">
                                    <option value="">No Security Hold</option>
                                </select>
                            </div>
                            <div class="form-group-inline">
                                <div class="form-group">
                                    <label for="security-code-input">Security Code (10 characters)</label>
                                    <input type="text" id="security-code-input" placeholder="ABC1234XYZ" maxlength="10" pattern="[A-Z0-9]{10}" style="text-transform: uppercase;">
                                </div>
                                <button type="button" id="generate-security-code-btn" class="btn-secondary">Generate</button>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline Configuration -->
                    <div class="form-section">
                        <h3>Timeline Configuration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="start-date-input">Start Date & Time</label>
                                <input type="datetime-local" id="start-date-input">
                            </div>
                            <div class="form-group">
                                <label for="number-events-input">Intermediate Events</label>
                                <input type="number" id="number-events-input" min="3" max="20" value="5">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline close-shipment-agent-modal">Cancel</button>
                <button type="button" id="preview-shipment-btn" class="btn btn-primary">Preview Timeline</button>
            </div>
        </div>
    </div>

    <!-- Shipment Preview Modal -->
    <div id="shipment-preview-modal" class="shipment-preview-modal">
        <div class="shipment-preview-modal-content">
            <div class="modal-header">
                <h2>ðŸ“¦ Shipment Timeline Preview</h2>
                <button class="close-modal-btn close-shipment-preview-modal">&times;</button>
            </div>

            <div class="modal-body">
                <div class="preview-summary">
                    <div class="preview-summary-grid">
                        <div class="preview-summary-item">
                            <label>Origin</label>
                            <div class="value" id="preview-origin">-</div>
                        </div>
                        <div class="preview-summary-item">
                            <label>Destination</label>
                            <div class="value" id="preview-destination">-</div>
                        </div>
                        <div class="preview-summary-item">
                            <label>Total Events</label>
                            <div class="value" id="preview-total-events">-</div>
                        </div>
                        <div class="preview-summary-item">
                            <label>Estimated Duration</label>
                            <div class="value" id="preview-duration">-</div>
                        </div>
                    </div>
                    <div class="preview-summary-item" style="margin-top: 12px;">
                        <label>Route</label>
                        <div class="value" id="preview-route">-</div>
                    </div>
                    <div id="preview-security-info" class="preview-security-info" style="display: none;">
                        <strong>Security Hold:</strong> <span id="preview-security-zone"></span>
                    </div>
                </div>

                <div class="events-timeline" id="preview-events-timeline">
                    <!-- Events loaded dynamically -->
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline close-shipment-preview-modal">Back to Edit</button>
                <button type="button" id="create-shipment-btn" class="btn btn-success">Create Shipment</button>
            </div>
        </div>
    </div>

    <!-- Socket.IO client for real-time updates -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js" integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI" crossorigin="anonymous"></script>
    <script src="js/admin-verification.js"></script>
    <script src="js/shipment-agent.js"></script>
</body>
</html>